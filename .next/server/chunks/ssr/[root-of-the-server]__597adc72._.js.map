{"version":3,"sources":["../../../../../../Projects/GoWatch/src/lib/api.ts","../../../../../../Projects/GoWatch/src/lib/watchlist.ts"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst envBase = (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.VITE_API_URL) || '';\r\nconst apiOrigin = envBase ? envBase.replace(/\\/$/, '') : '';\r\nconst baseURL = apiOrigin ? `${apiOrigin}/api` : '/api';\r\n\r\nexport const api = axios.create({ baseURL });\r\n\r\nexport function setAuthToken(token: string | null) {\r\n  if (token) {\r\n    api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n  } else {\r\n    delete api.defaults.headers.common['Authorization'];\r\n  }\r\n}\r\n\r\nexport function mediaUrl(path: string | null | undefined): string {\r\n  if (!path) return '';\r\n  if (/^https?:\\/\\//i.test(path)) return path;\r\n  if (apiOrigin && path.startsWith('/')) return `${apiOrigin}${path}`;\r\n  return path;\r\n}\r\n\r\ntry {\r\n  const t = localStorage.getItem('gowatch_token');\r\n  if (t) setAuthToken(t);\r\n} catch (e) {\r\n}\r\n\r\napi.interceptors.response.use(\r\n  (res) => res,\r\n  (err) => {\r\n    const status = err?.response?.status;\r\n    if (status === 401) {\r\n      try { localStorage.removeItem('gowatch_token'); } catch {}\r\n      try { localStorage.removeItem('gowatch_user'); } catch {}\r\n      try { setAuthToken(null); } catch {}\r\n      try { window.dispatchEvent(new CustomEvent('gowatch:openAuth', { detail: { message: 'Session expired. Please sign in again.' } })); } catch {}\r\n    }\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n","import { api } from './api';\r\n\r\nexport async function ensureDemoUser(username = 'demo') {\r\n  const res = await api.post('/users', { username });\r\n  return res.data.user;\r\n}\r\n\r\nexport async function addToWatchlist(movie: any) {\r\n  const res = await api.post('/watchlist', { movie });\r\n  return res.data;\r\n}\r\n\r\nexport async function removeFromWatchlist(movieId: string) {\r\n  const res = await api.delete(`/watchlist/${encodeURIComponent(movieId)}`);\r\n  return res.data;\r\n}\r\n\r\nexport async function getWatchlist() {\r\n  const res = await api.get(`/watchlist`);\r\n  return res.data.watchlist;\r\n}\r\n"],"names":[],"mappings":"oIAAA,IAAA,EAAA,EAAA,CAAA,CAAA,qHAEM,EAAU,AAAuC,EAAqB,GAAG,EAAI,EAAqB,GAAG,CAAC,YAAY,EAAK,GACvH,EAAY,EAAU,EAAQ,OAAO,CAAC,GADJ,GACW,IAAM,GACnD,EAAU,EAAY,CAAA,EAAG,EAAU,IAAI,CAAC,CAAG,OAEpC,EAAM,EAAA,OAAK,CAAC,MAAM,CAAC,CAAE,SAAQ,GAEnC,SAAS,EAAa,CAAoB,EAC3C,EACF,EAAI,GADK,KACG,CAAC,OAAO,CAAC,MAAM,CAAC,aAAgB,CAAG,CAAC,OAAO,EAAE,EAAA,CAAO,CAEhE,OAAO,EAAI,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,aAAgB,AAEvD,CAEO,SAAS,EAAS,CAA+B,SACtD,AAAK,EACD,EADA,EAAO,YACS,IAAI,CAAC,GAAc,EACnC,EAD4B,CACf,EAAK,UAAU,CAAC,KAAa,CAAP,AAAO,EAAG,EAAA,EAAY,EAAA,CAAM,CAC5D,EAHW,EAIpB,CAEA,GAAI,CACF,IAAM,EAAI,aAAa,OAAO,CAAC,iBAC3B,GAAG,EAAa,EACtB,CAAE,MAAO,EAAG,CACZ,CAEA,EAAI,YAAY,CAAC,QAAQ,CAAC,GAAG,CAC3B,AAAC,GAAQ,EACT,AAAC,IACC,IAAM,EAAS,GAAK,UAAU,OAC9B,GAAe,MAAX,EAAgB,CAClB,GAAI,CAAE,aAAa,UAAU,CAAC,gBAAkB,CAAE,KAAM,CAAC,CACzD,GAAI,CAAE,aAAa,UAAU,CAAC,eAAiB,CAAE,KAAM,CAAC,CACxD,GAAI,CAAE,EAAa,KAAO,CAAE,KAAM,CAAC,CACnC,GAAI,CAAE,OAAO,aAAa,CAAC,IAAI,YAAY,mBAAoB,CAAE,OAAQ,CAAE,QAAS,wCAAyC,CAAE,GAAK,CAAE,KAAM,CAAC,CAC/I,CACA,OAAO,QAAQ,MAAM,CAAC,EACxB,gHCxCF,IAAA,EAAA,EAAA,CAAA,CAAA,gBAEO,eAAe,EAAe,EAAW,MAAM,EAEpD,MADY,AACL,OADW,EAAA,GAAG,CAAC,IAAI,CAAC,SAAU,UAAE,CAAS,EAAA,EACrC,IAAI,CAAC,IAAI,AACtB,CAEO,eAAe,EAAe,CAAU,EAE7C,MAAO,AADK,OAAM,EAAA,GAAG,CAAC,IAAI,CAAC,aAAc,OAAE,CAAM,EAAA,EACtC,IAAI,AACjB,CAEO,eAAe,EAAoB,CAAe,EAEvD,MAAO,CADK,MAAM,EAAA,GAAG,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,mBAAmB,GAAA,EAAU,EAC7D,IAAI,AACjB,CAEO,eAAe,IAEpB,MAAO,CADK,MAAM,EAAA,GAAG,CAAC,GAAG,CAAC,CAAC,UAAU,EAAC,EAC3B,IAAI,CAAC,SAAS,AAC3B"}